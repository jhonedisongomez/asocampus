<link rel="import" href="../elements.html">

<dom-module id="list-activity">
    <style>
        .container {
        @apply(--layout-horizontal);

        }
        .paper-card-0 .header.paper-card .title-text.paper-card {
            padding: 16px;
            font-size: 24px;
            font-weight: 400;
            color: white;
        }

        .button-paper-card { color: var(--google-blue-500); }

        .green {
            border: 2px solid;
            border-color: #4caf50;
            background-color: #f1f8e9;
            color: #4caf50;
        }

        footer{

            background: black;
            color: white;
            height: 65px;
            margin: 0;
            margin-top: 15px;
        }

    </style>
    <template>
        <div class="horizontal layout wrap" style="margin-top: 140px;padding: 10px;">

            <iron-ajax id ="list-ajax-activity"
                       on-response="response"
                       url = ""
                       handle-as="json">
            </iron-ajax>

            <template is="dom-repeat" items="[[repos]]">


                <div style="margin-top: 20px;
                    max-width: 350px;
                    min-width: 100px;">

                    <paper-material elevation = "5">
                        <paper-toolbar style="margin-top: -24px;
                        background: rgb(34, 198, 30);">
                            <div class="title">[[item.topic]]</div>
                        </paper-toolbar>

                        <div>
                            <img style="width: 100%;" src="[[item.image_url]]">

                        </div>

                        <p style="padding: 20px;">[[item.pre_description]]</p>
                        <hr>
                        <paper-button class="button-paper-card"  name="[[item.activity_code]]"
                                       on-click="signUpActivity">Inscribite</paper-button>

                        <paper-button class="button-paper-card">Ver Mas</paper-button>

                    </paper-material>

                </div>
            </template>
        </div>

        <iron-ajax id ="axSignUpActivity"
                   on-response="signUpActivityResponse"
                   contentType="application/x-www-form-urlencoded; charset=UTF-8"
                   url = ""
                   handle-as="json">
        </iron-ajax>

        <paper-dialog entry-animation="scale-up-animation"
                      exit-animation="fade-out-animation" id="dialog"
                      class="green"
                      modal = "true">
            <h2>Mensaje</h2>
            <div id="dialog-body">[[body]]</div>
            <div class="buttons">
                <paper-button dialog-dismiss>Cerrar</paper-button>

            </div>

        </paper-dialog>
        <!---<footer>

        <p>develop by Jhon Edison Gomez </p>
        </footer><!--->
    </template>

</dom-module>

<script>

    Polymer({
        is: "list-activity",
        properties: {
        },
        ready: function()
        {
            var url = ""
            url = document.URL;
            var ajaxUrl = "?load=true"
            url = url + ajaxUrl;
            this.querySelector('iron-ajax#list-ajax-activity').url = url
            this.querySelector('iron-ajax#list-ajax-activity').generateRequest();
        },

        response: function(request){
            console.log(request.detail.response.activity_list);
            this.repos = request.detail.response.activity_list;


        },

        signUpActivity:function(event){

            var csrftoken = document.getElementById("csrfmiddlewaretoken").value;
            this.$.axSignUpActivity.method = "POST";
            this.$.axSignUpActivity.url = document.URL;
            this.$.axSignUpActivity.body = {'activity_code': event.target.name};
            this.$.axSignUpActivity.headers = {
                "X-CSRFToken":  getCookie('csrftoken'),
                "X-Requested-With": "XMLHttpRequest",
                "content-type": "application/json"
            };

            this.$.axSignUpActivity.generateRequest();
        },

        signUpActivityResponse:function(request){

            this.body = request.detail.response.message;
            this.$.dialog.open();
        },

    });
    function _toggle(id) {
        var moreInfo = document.getElementById(id);
        var iconButton = Polymer.dom(event).localTarget;
        iconButton.icon = moreInfo.opened ? 'hardware:keyboard-arrow-down'
                : 'hardware:keyboard-arrow-up';
        moreInfo.toggle();
    }


</script>