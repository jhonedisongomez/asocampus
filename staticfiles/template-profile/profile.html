<link rel="import" href="../elements.html">

<dom-module id="profile-user">

    <style>

        .title-text  style-scope paper-card {
            padding: 16px;
            font-size: 24px;
            font-weight: 400;
            color: white;
            background: #06780b;
        }

        #bntEdit{
            width: 95%;
            background: #06780b;
            color: white;
        }

    </style>

    <template>
        <div class="horizontal layout wrap">

            <iron-ajax id ="ajax-profile"
                on-response="response"
                url = ""
                handle-as="json">
            </iron-ajax>

            <template is="dom-repeat" items="[[profile]]">

                <div style="margin-left: 10px;
                    margin-top: 80px;
                    max-width: 400px;">

                    <paper-material elevation="5"
                        style="max-width: 380px;
                            margin-left: 31%;
                            background: white;
                            margin: 0 auto;">

                        <paper-toolbar class="toolbar-main"
                                style="margin-top: -24px;">
                            <div class="title">Mi perfil</div>
                        </paper-toolbar>

                        <div id="profile-form" style="padding: 10%;
                                min-width: 60px;">

                                <form is="iron-form"
                                    id="signUpForm"
                                    style="padding: 17px;
                                    max-width: 100%;">

                                    <paper-dropdown-menu
                                        label="Tipo de documento"
                                        id="selectDocumentId"
                                        style="width: 100%;">

                                        <paper-listbox
                                        slot="dropdown-content"
                                        id="paperListBoxDocumentType"
                                        attrForSelected="value"
                                        selected="0">

                                            <paper-item>Seleccione una opción</paper-item>
                                            <paper-item>Cedula</paper-item>
                                            <paper-item>Tarjeta de identidad</paper-item>
                                            <paper-item>registro civil</paper-item>
                                            <paper-item>Número de pasaporte</paper-item>
                                        </paper-listbox>
                                    </paper-dropdown-menu>

                                    <paper-input
                                        required auto-validate
                                        error-message="El campo no puede estar vacío."
                                        id="documentNumber"
                                        label="N° de documento"
                                        required
                                        value="[[ item.document_id]]"
                                        readonly = true>
                                    </paper-input>

                                    <paper-input
                                        required
                                        auto-validate
                                        error-message="El campo no puede estar vacío."
                                        id="firstName"
                                        label="Nombres"
                                        value="[[ item.first_name]]"
                                        readonly=true
                                        required>
                                    </paper-input>

                                    <paper-input
                                        required
                                        auto-validate
                                        error-message="El campo no puede estar vacío."
                                        id="lastName"
                                        label="Apellidos"
                                        value="[[ item.last_name]]"
                                        readonly=true
                                        required>
                                    </paper-input>

                                    <paper-input
                                    error-message="El campo no puede estar vacío."
                                    id="phoneNumber"
                                    label="Telfono Fijo"
                                    value="[[ item.phone_number]]"
                                    readonly=true
                                    required>
                                </paper-input>

                                <paper-input
                                    error-message="El campo no puede estar vacío."
                                    id="mobilNumber"
                                    label="Celular"
                                    value="[[ item.mobil_number]]"
                                    readonly=true
                                    required>
                                </paper-input>

                                <paper-input
                                    error-message="El campo no puede estar vacío."
                                    id="email"
                                    label="Correo electronico"
                                    value="[[ item.email]]"
                                    readonly=true
                                    required>
                                </paper-input>

                                    <paper-button on-click="btnEditProfile"
                                    raised style="width: 100%;margin-top: 23px;background:#06780b;
                                    color: white;" >EDITAR</paper-button>
                                </form>

                    </paper-material>
                </div>
            </template>

        </div>

      <iron-ajax
          id="ajaxProfile"
          url=""
          handle-as="json"
          on-response="profileResponse">
      </iron-ajax>

        <paper-dialog entry-animation="scale-up-animation"
            exit-animation="fade-out-animation" id="dialog"
            class="colored"
            modal = "true">
            <h2>Mensaje</h2>
            <div id="dialog-body">[[body]]</div>
            <div class="buttons">
                <paper-button dialog-dismiss>Cerrar</paper-button>

            </div>

        </paper-dialog>

    </template>

<script>

    function validateEditForm(){

        if(document.getElementById('documentNumber').validate() &&
            document.getElementById('firstName').validate() &&
            document.getElementById('lastName').validate() &&
            document.getElementById('mobilNumber').validate())
        {
            return true;
        }else
        {
            return false;
        }

    }

    Polymer({
        is: "profile-user",
        properties: {
        },

        ready: function()
        {
            var url = ""
            url = document.URL;
            var ajaxUrl = "?load=true"
            url = url + ajaxUrl;
            this.querySelector('iron-ajax#ajax-profile').url = url
            this.querySelector('iron-ajax#ajax-profile').generateRequest();

        },

        response: function(request){

            this.profile = request.detail.response.data;
            this.$.documentNumber.value = this.profile[0].document_id;
            this.$.firstName.value = this.profile[0].first_name;
            this.$.lastName.value = this.profile[0].last_name;
            this.$.phoneNumber.value = this.profile[0].phone_number;
            this.$.mobilNumber.value = this.profile[0].mobil_number;
            this.$.email.value = this.profile[0].email;
            

        },

        openDialogFunction:function(event){
            this.$.dlgEditProfile.center();
            this.$.dlgEditProfile.open();
        },

        btnEditProfile:function(event){

            if(validateEditForm()){

                var csrftoken = document.getElementById("csrfmiddlewaretoken").value;
                this.$.ajaxProfile.method = "POST";
                this.$.ajaxProfile.url = document.URL;

                this.$.ajaxProfile.body = {
                    
                    'id_type': this.querySelector('paper-listbox#paperListBoxDocumentType').selected,
                    'document_id': this.$.documentNumber.value,
                    'first_name': this.$.firstName.value,
                    'last_name': this.$.lastName.value,
                    'phone_number': this.$.phoneNumber.value,
                    'mobil_number': this.$.mobilNumber.value,
                    'method': 'edit'
                };

                this.$.ajaxProfile.headers = {
                    "X-CSRFToken":  getCookie('csrftoken'),
                    "X-Requested-With": "XMLHttpRequest",
                    "content-type": "application/json"
                };

                this.$.ajaxProfile.generateRequest();

            }else{
                console.log("formulario invalido");
            }
        },

        profileResponse: function(request) {
            this.body = request.detail.response.message;
            this.$.dialog.open();
        },

    });

</script>
</dom-module>

